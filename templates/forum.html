{% extends "base.html" %}
{% block content %}
<!-- Your existing action-bar, new-post-panel unchanged -->

<section class="post-list">
  {% for post in posts %}
  <article class="post-card post-{{ post.color }}">
    <header class="post-header">
      <div class="avatar">{{ post.author[0]|upper }}</div>
      <div>
        <div class="post-author">{{ post.author }}</div>
        <div class="post-meta">
          <span class="post-tag">{{ post.course }}</span>
          <span class="post-time">{{ post.time }}</span>
        </div>
      </div>
    </header>
    <p class="post-text">{{ post.text }}</p>
    
    <!-- ADD COMMENTS HERE -->
    <div class="comments-section">
      <!-- Comment form -->
      <form id="comment-form-{{ post.id }}" class="comment-form" style="margin: 10px 0;">
        <input type="text" name="comment_author" placeholder="Your name" maxlength="50" style="width: 100px;">
        <textarea name="comment_text" placeholder="Add comment..." required style="width: 300px; height: 60px;"></textarea>
        <button type="submit" style="margin-left: 10px;">Comment</button>
      </form>
      
      <!-- Comments display -->
      <div class="comments-list" id="comments-{{ post.id }}" style="margin-top: 10px;">
        {% for comment in post.comments_list %}
        <div class="comment" style="background: #f5f5f5; padding: 8px; margin: 5px 0; border-radius: 4px;">
          <strong>{{ comment.author }}</strong> ({{ comment.time }}): {{ comment.text }}
        </div>
        {% endfor %}
      </div>
    </div>
    <!-- END COMMENTS -->
    
    <footer class="post-footer">
      <button class="icon-button like-btn" data-id="{{ post.id }}">
        ‚ù§Ô∏è <span>{{ post.likes }}</span>
      </button>
      <button class="icon-button comment-toggle" data-id="{{ post.id }}">
        üí¨ <span>{{ post.comments }}</span>
      </button>
    </footer>
  </article>
  {% endfor %}
</section>

<!-- ADD JS AT BOTTOM OF BLOCK (before {% endblock %}) -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {
  // Existing like button JS (add if missing)
  $('.like-btn').on('click', function() {
    var postId = $(this).data('id');
    $.post('/like/' + postId, function() {
      location.reload();
    });
  });
  
  // NEW: Comment form JS
  $('.comment-form').on('submit', function(e) {
    e.preventDefault();
    var form = $(this);
    var postId = form.attr('id').split('-')[2];
    $.post('/comment/' + postId, form.serialize(), function() {
      location.reload();  // Simple: reload to show comments
    });
  });
});
</script>
{% endblock %}
