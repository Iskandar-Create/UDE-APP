{% extends "base.html" %}
{% block content %}
<section class="action-bar">
  <button class="primary-button" id="open-form-btn">+ Ask a Question</button>
</section>

<section class="new-post-panel" id="new-post-panel">
  <form method="post" class="new-post-form">
    <div class="field-row">
      <input name="author" placeholder="Your name" />
      <input name="course" placeholder="Course (e.g. Calculus II)" />
    </div>
    <textarea name="text" rows="4" placeholder="Describe your question..."></textarea>
    <div class="form-actions">
      <button type="button" class="secondary-button" id="cancel-form-btn">Cancel</button>
      <button type="submit" class="primary-button">Post</button>
    </div>
  </form>
</section>

<section class="post-list">
  {% for post in posts %}
  <article class="post-card post-{{ post.color }}">
    <header class="post-header">
      <div class="avatar">{{ post.author[0]|upper }}</div>
      <div>
        <div class="post-author">{{ post.author }}</div>
        <div class="post-meta">
          <span class="post-tag">{{ post.course }}</span>
          <span class="post-time">{{ post.time }}</span>
        </div>
      </div>
    </header>
    <p class="post-text">{{ post.text }}</p>
    
    <!-- COMMENTS SECTION -->
    <div class="comments-toggle" data-post-id="{{ post.id }}">
      <button class="toggle-comments-btn">
        üí¨ {{ post.comments }} comments
      </button>
    </div>
    <div class="comments-panel" id="comments-{{ post.id }}" style="display: none;">
      <!-- Add new comment form -->
      <div class="new-comment-form">
        <input type="text" id="comment-author-{{ post.id }}" placeholder="Your name">
        <textarea id="comment-text-{{ post.id }}" placeholder="Write a comment..." required></textarea>
        <button onclick="addComment({{ post.id }})">Post Comment</button>
      </div>
      
      <!-- Existing comments -->
      <div class="comments-list">
        {% for comment in post.comments_list %}
        <div class="comment-item">
          <div class="comment-header">
            <span class="comment-author">{{ comment.author }}</span>
            <span class="comment-time">{{ comment.time }}</span>
          </div>
          <div class="comment-body">{{ comment.text }}</div>
        </div>
        {% endfor %}
      </div>
    </div>
    
    <footer class="post-footer">
      <button class="icon-button like-btn" data-id="{{ post.id }}">
        ‚ù§Ô∏è <span>{{ post.likes }}</span>
      </button>
      <button class="icon-button">
        üí¨ <span>{{ post.comments }}</span>
      </button>
    </footer>
  </article>
  {% endfor %}
</section>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {
  $('.like-btn').click(function() {
    var postId = $(this).data('id');
    $.post('/like/' + postId, function() {
      location.reload();
    });
  });
  
  $('.comment-form').submit(function(e) {
    e.preventDefault();
    var form = $(this);
    var postId = form.attr('id').split('-')[2];
    $.post('/comment/' + postId, form.serialize(), function() {
      location.reload();
    });
  });
});
</script>
{% endblock %}

